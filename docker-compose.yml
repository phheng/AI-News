services:
  crypto-intel-news-agent:
    build:
      context: ../workspace-crypto-intel-news-agent/apps/news-agent
    container_name: crypto-intel-news-agent
    restart: unless-stopped
    networks: [default, infra_backend]
    environment:
      CRYPTO_INTEL_MYSQL_HOST: mysql
      CRYPTO_INTEL_MYSQL_PORT: 3306
      CRYPTO_INTEL_MYSQL_USER: root
      CRYPTO_INTEL_MYSQL_PASSWORD: nzh278799
      CRYPTO_INTEL_MYSQL_DATABASE: crypto_intel
      CRYPTO_INTEL_NEWS_COLLECTOR_ENABLED: 1
      CRYPTO_INTEL_NEWS_COLLECTOR_INTERVAL_SEC: 120
      CRYPTO_INTEL_NEWS_COLLECTOR_SOURCES: coindesk,cointelegraph,decrypt

  crypto-intel-market-agent:
    build:
      context: ../workspace-crypto-intel-market-agent/apps/market-agent
    container_name: crypto-intel-market-agent
    restart: unless-stopped
    networks: [default, infra_backend]
    environment:
      CRYPTO_INTEL_MYSQL_HOST: mysql
      CRYPTO_INTEL_MYSQL_PORT: 3306
      CRYPTO_INTEL_MYSQL_USER: root
      CRYPTO_INTEL_MYSQL_PASSWORD: nzh278799
      CRYPTO_INTEL_MYSQL_DATABASE: crypto_intel
      CRYPTO_INTEL_MARKET_COLLECTOR_ENABLED: 1
      CRYPTO_INTEL_MARKET_COLLECTOR_INTERVAL_SEC: 60
      CRYPTO_INTEL_MARKET_COLLECTOR_SYMBOLS: BTCUSDT,ETHUSDT
      CRYPTO_INTEL_MARKET_COLLECTOR_TIMEFRAMES: 15m,1h,4h,1d

  crypto-intel-strategy-agent:
    build:
      context: ../workspace-crypto-intel-strategy-agent/apps/strategy-agent
    container_name: crypto-intel-strategy-agent
    restart: unless-stopped
    networks: [default, infra_backend]
    environment:
      CRYPTO_INTEL_REDIS_URL: redis://redis:6379/0
      CRYPTO_INTEL_MYSQL_HOST: mysql
      CRYPTO_INTEL_MYSQL_PORT: 3306
      CRYPTO_INTEL_MYSQL_USER: root
      CRYPTO_INTEL_MYSQL_PASSWORD: nzh278799
      CRYPTO_INTEL_MYSQL_DATABASE: crypto_intel
      CRYPTO_INTEL_STRATEGY_AUTO_GENERATE_ENABLED: 1
      CRYPTO_INTEL_STRATEGY_AUTO_GENERATE_INTERVAL_SEC: 180

  crypto-intel-backtest-agent:
    build:
      context: ../workspace-crypto-intel-backtest-agent/apps/backtest-agent
    container_name: crypto-intel-backtest-agent
    restart: unless-stopped
    networks: [default, infra_backend]
    environment:
      CRYPTO_INTEL_MYSQL_HOST: mysql
      CRYPTO_INTEL_MYSQL_PORT: 3306
      CRYPTO_INTEL_MYSQL_USER: root
      CRYPTO_INTEL_MYSQL_PASSWORD: nzh278799
      CRYPTO_INTEL_MYSQL_DATABASE: crypto_intel
      CRYPTO_INTEL_REDIS_URL: redis://redis:6379/0

  crypto-intel-api-gateway:
    build:
      context: ./apps/api-gateway
    container_name: crypto-intel-api-gateway
    restart: unless-stopped
    depends_on:
      - crypto-intel-news-agent
      - crypto-intel-market-agent
      - crypto-intel-strategy-agent
      - crypto-intel-backtest-agent
    networks: [default, infra_backend]
    environment:
      CRYPTO_INTEL_APP_ENV: dev
      CRYPTO_INTEL_MYSQL_HOST: mysql
      CRYPTO_INTEL_MYSQL_PORT: 3306
      CRYPTO_INTEL_MYSQL_USER: root
      CRYPTO_INTEL_MYSQL_PASSWORD: nzh278799
      CRYPTO_INTEL_MYSQL_DATABASE: crypto_intel
      CRYPTO_INTEL_REDIS_URL: redis://redis:6379/0
      CRYPTO_INTEL_NEWS_AGENT_BASE: http://crypto-intel-news-agent:18101
      CRYPTO_INTEL_MARKET_AGENT_BASE: http://crypto-intel-market-agent:18102
      CRYPTO_INTEL_STRATEGY_AGENT_BASE: http://crypto-intel-strategy-agent:18103
      CRYPTO_INTEL_BACKTEST_AGENT_BASE: http://crypto-intel-backtest-agent:18104
    ports:
      - "18080:18080"

  crypto-intel-frontend:
    build:
      context: ./apps/frontend
    container_name: crypto-intel-frontend
    restart: unless-stopped
    depends_on:
      - crypto-intel-api-gateway
    ports:
      - "15174:80"

networks:
  infra_backend:
    external: true
